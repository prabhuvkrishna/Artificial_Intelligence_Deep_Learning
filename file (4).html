<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Table Tennis Game with Settings</title>
  <style>
    html, body {
      height: 100%; margin: 0; padding: 0;
    }
    body {
      min-height: 100vh;
      background: url('https://raw.githubusercontent.com/https-deeplearning-ai/lc-build-with-andrew-platform/main/img/tabletennis43.jpg') no-repeat center center;
      background-size: cover;
      box-sizing: border-box;
    }
    .settings {
      text-align: center;
      padding: 20px 0 0 0;
      color: white;
      font-size: 20px;
      text-shadow: 1px 1px 5px #000;
    }
    .settings label, .settings input {
      margin: 0 10px 0 0;
    }
    .btn-group button {
      background: #444;
      color: #fff;
      border: none;
      padding: 8px 18px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 16px;
      transition: background 0.2s;
    }
    .btn-group button.active, .btn-group button:hover {
      background: #08f;
      color: #fff;
    }
    .canvas-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
    }
    canvas {
      display: block;
      background: #228B22;
      box-shadow: 0 0 24px #111;
      border-radius: 20px;
    }
    .scores {
      text-align: center;
      color: #fff;
      font-size: 24px;
      margin-top: 16px;
      font-family: Arial, sans-serif;
      text-shadow: 1px 1px 5px #000;
    }
  </style>
</head>
<body>
  <div class="settings">
    <span><strong>Difficulty:</strong></span>
    <span class="btn-group">
      <button id="easyBtn" class="active">Easy</button>
      <button id="mediumBtn">Medium</button>
      <button id="hardBtn">Hard</button>
    </span>
    <label for="winPoints"><strong>Points to Win:</strong></label>
    <input type="number" id="winPoints" min="1" value="5" style="width: 50px;">
  </div>

  <div class="canvas-container">
    <canvas id="gameCanvas" width="600" height="400"></canvas>
  </div>

  <div class="scores" id="scoresArea"></div>

  <script>
    // Game settings
    let difficulty = "easy";
    let pointsToWin = 5;
    const aiSpeeds = {
      easy: 3,
      medium: 4.5,
      hard: 7
    };

    // Canvas/Game constants
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let CW = canvas.width, CH = canvas.height;
    let PADDLE_W, PADDLE_H, BALL_SIZE, PLAYER_X, COMP_X;
    const PADDLE_SPEED = 6;

    // Game state
    let playerY, compY, ballX, ballY, ballVX, ballVY;
    let upPressed = false, downPressed = false;
    let playerScore = 0, compScore = 0;
    let gameOver = false;

    function updateDimensions() {
      CW = canvas.width;
      CH = canvas.height;
      PADDLE_W = Math.round(CW * 0.017);
      PADDLE_H = Math.round(CH * 0.175);
      BALL_SIZE = Math.round(CH * 0.035);
      PLAYER_X = Math.round(CW * 0.05);
      COMP_X = CW - PLAYER_X - PADDLE_W;
    }

    // User changes
    document.getElementById('easyBtn').onclick = function() { setDifficulty('easy'); }
    document.getElementById('mediumBtn').onclick = function() { setDifficulty('medium'); }
    document.getElementById('hardBtn').onclick = function() { setDifficulty('hard'); }
    document.getElementById('winPoints').onchange = function() {
      let val = parseInt(this.value);
      if(val < 1) val = 1;
      pointsToWin = val;
      this.value = val;
      resetGame();
    }

    function setDifficulty(level) {
      difficulty = level;
      document.getElementById('easyBtn').classList.remove('active');
      document.getElementById('mediumBtn').classList.remove('active');
      document.getElementById('hardBtn').classList.remove('active');
      document.getElementById(level + 'Btn').classList.add('active');
      resetGame();
    }

    // Key events
    document.addEventListener('keydown', function(e) {
      if(e.key === "ArrowUp") upPressed = true;
      if(e.key === "ArrowDown") downPressed = true;
    });
    document.addEventListener('keyup', function(e) {
      if(e.key === "ArrowUp") upPressed = false;
      if(e.key === "ArrowDown") downPressed = false;
    });

    function draw() {
      updateDimensions();
      // Green playground
      ctx.fillStyle = "#228B22";
      ctx.fillRect(0,0,CW,CH);

      // Middle net
      ctx.save();
      ctx.globalAlpha = 0.6;
      ctx.strokeStyle = "#fff";
      ctx.lineWidth = 3;
      for(let y=0;y<CH;y+=30) {
        ctx.beginPath();
        ctx.moveTo(CW/2, y);
        ctx.lineTo(CW/2, y+15);
        ctx.stroke();
      }
      ctx.restore();

      // Player paddle (beige)
      ctx.fillStyle = "#f5deb3";
      ctx.fillRect(PLAYER_X, playerY, PADDLE_W, PADDLE_H);

      // Computer paddle (beige)
      ctx.fillStyle = "#f5deb3";
      ctx.fillRect(COMP_X, compY, PADDLE_W, PADDLE_H);

      // Ball (white)
      ctx.beginPath();
      ctx.arc(ballX, ballY, BALL_SIZE/2, 0, Math.PI*2);
      ctx.fillStyle = "#fff";
      ctx.shadowColor = "#000";
      ctx.shadowBlur = 4;
      ctx.fill();
      ctx.shadowBlur = 0;

      // Show win message if game is over
      if (gameOver) {
        ctx.font = Math.round(CH/12) + "px Arial";
        ctx.fillStyle = "#fff";
        ctx.textAlign = "center";
        ctx.fillText(winnerText(), CW/2, CH/2);
        ctx.textAlign = "start";
      }
    }

    function winnerText() {
      if (playerScore >= pointsToWin) return "You Win! ðŸš€";
      if (compScore >= pointsToWin) return "Computer Wins!";
      return "";
    }

    function update() {
      if (gameOver) return;

      // Move player's paddle
      if(upPressed && playerY>0) playerY -= PADDLE_SPEED;
      if(downPressed && playerY+PADDLE_H<CH) playerY += PADDLE_SPEED;
      
      // Computer paddle (AI)
      let aiSpeed = aiSpeeds[difficulty];
      if (ballY < compY + PADDLE_H/2) compY -= aiSpeed;
      else if (ballY > compY + PADDLE_H/2) compY += aiSpeed;
      if (compY < 0) compY = 0;
      if (compY + PADDLE_H > CH) compY = CH-PADDLE_H;
      
      // Move ball
      ballX += ballVX;
      ballY += ballVY;

      // Bounce off top/bottom
      if(ballY <= BALL_SIZE/2 || ballY >= CH - BALL_SIZE/2)
        ballVY *= -1;

      // Paddle collision (player)
      if(
        ballX - BALL_SIZE/2 <= PLAYER_X + PADDLE_W &&
        ballY + BALL_SIZE/2 >= playerY &&
        ballY - BALL_SIZE/2 <= playerY + PADDLE_H
      ) {
        ballVX *= -1.03;
        ballX = PLAYER_X + PADDLE_W + BALL_SIZE/2;
      }
      // Paddle collision (computer)
      if(
        ballX + BALL_SIZE/2 >= COMP_X &&
        ballY + BALL_SIZE/2 >= compY &&
        ballY - BALL_SIZE/2 <= compY + PADDLE_H
      ) {
        ballVX *= -1.03;
        ballX = COMP_X - BALL_SIZE/2;
      }

      // Score and reset
      if(ballX < 0) {
        compScore++;
        checkGameOver();
        resetBall();
      }
      if(ballX > CW) {
        playerScore++;
        checkGameOver();
        resetBall();
      }
    }

    function checkGameOver() {
      if (playerScore >= pointsToWin || compScore >= pointsToWin) {
        gameOver = true;
      }
    }

    function resetBall() {
      updateDimensions();
      ballX = CW/2;
      ballY = CH/2;
      // Start ball toward whoever lost last
      ballVX = (Math.random()>0.5?1:-1)*5;
      ballVY = (Math.random()-0.5)*6;
    }

    function resetGame() {
      updateDimensions();
      playerScore = 0;
      compScore = 0;
      gameOver = false;
      playerY = CH/2 - PADDLE_H/2;
      compY = CH/2 - PADDLE_H/2;
      resetBall();
      updateScores();
    }

    function updateScores() {
      document.getElementById("scoresArea").textContent = 
        `Player: ${playerScore}   |   Computer: ${compScore}   |   First to ${pointsToWin} wins`;
    }

    function resizeCanvas() {
      // Keep 3:2 ratio
      let w = window.innerWidth * 0.9;
      let h = window.innerHeight * 0.6;
      let ratio = 3/2;
      if (w/h > ratio) w = h * ratio;
      else h = w / ratio;
      w = Math.max(300, Math.min(800, w));
      h = Math.max(200, Math.min(600, h));
      canvas.width = w;
      canvas.height = h;
      updateDimensions();
      playerY = Math.min(playerY, CH - PADDLE_H);
      compY = Math.min(compY, CH - PADDLE_H);
      draw(); // redraw
    }

    // Make sure everything is initialized before starting
    resetGame();
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function gameLoop() {
      update();
      draw();
      updateScores();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

  </script>
</body>
</html>
